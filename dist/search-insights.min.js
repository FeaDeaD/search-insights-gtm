!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AlgoliaAnalytics=t()}(this,function(){"use strict";var e=function(){var e=this;if(this.storeClick=function(t,n){var i=JSON.parse(localStorage.getItem("insights-store"))||{};i[t]={queryID:n,eventTimestamp:(new Date).getTime()},localStorage.setItem(e._storageKey,JSON.stringify(i))},this.getConversionObjectID=function(t){var n=e.getStorageData()[t];return n||!1},this.cleanOldStorage=function(e,t){var n=Object.keys(t);return n.length>0?n.reduce(function(n,i){var r=t[i];return Math.abs(e-r.eventTimestamp)/36e5<=6&&(n[i]=r),n},{}):{}},this.getStorageData=function(){return JSON.parse(localStorage.getItem("insights-store"))||{}},!function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}("localStorage"))throw new Error("LocalStorage is not available");this._storageKey="insights-store";var t=(new Date).getTime(),n=this.getStorageData(),i=this.cleanOldStorage(t,n);localStorage.setItem(this._storageKey,JSON.stringify(i))},t=function(e,t,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var r="expires="+i.toUTCString();document.cookie=e+"="+t+";"+r+";path=/"},n=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},i=function(e){var i=function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}("_ALGOLIA");if(i&&""!==i)return t("_ALGOLIA",i,10),i;var r=n();return t("_ALGOLIA",r,10),r};return new function(t){if(this._hasCredentials=!1,!document.addEventListener||!window)throw new Error("Browser does not support eventlistener or there is no window object.");this.storageManager=new e,this.processQueue=function(){var e=this,t=window.AlgoliaAnalyticsObject;t&&((window[t].queue||[]).forEach(function(t){var n=t[0],i=t[1];n&&"function"==typeof e[n]&&e[n](i)}),window[t]=function(t,n){e[t](n)})}.bind(this),this.sendEvent=function(e,t){var n=this;t.timestamp=Date.now(),t.userID=this._userID;var i="https://insights.algolia.io/1/searches/"+e+"?X-Algolia-Application-Id="+this._applicationID+"&X-Algolia-API-Key="+this._apiKey;if(navigator&&"function"==typeof navigator.sendBeacon&&"search"!==e)navigator.sendBeacon(i,JSON.stringify(t));else{var r=new XMLHttpRequest;r.open("POST",i),"search"===e&&(r.onreadystatechange=function(){if(4===r.readyState&&r.responseText){var e=r&&r.responseText?JSON.parse(r.responseText):{};n._lastQueryID=e.queryID}}),r.send(JSON.stringify(t))}}.bind(this),this.init=function(e){if(!e)throw new Error("Init function should be called with an object argument containing your apiKey and applicationID");if(!e.apiKey||"string"!=typeof e.apiKey)throw new Error("apiKey is missing, please provide it so we can authenticate the application");if(!e.applicationID||"string"!=typeof e.applicationID)throw new Error("applicationID is missing, please provide it, so we can properly attribute data to your application");this._apiKey=e.apiKey,this._applicationID=e.applicationID,this._hasCredentials=!0}.bind(this),this.initSearch=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("initSearch function requires an argument with getQueryID and hitsContainer arguments");if(!e.getQueryID||"function"!=typeof e.getQueryID)throw new Error("getQueryID must be a function that returns the queryID of the last search operation");this.getQueryID=e.getQueryID}.bind(this),this.click=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("No params were sent to click function, please provide an objectID and position to be reported");if(!e.objectID)throw new Error("required objectID parameter was not sent, click event can not be properly attributed");if(!e.position)throw new Error("required position parameter was not sent, click event position can not be properly sent without");var t=e.queryID;if("function"!=typeof this.getQueryID||t||(t=this.getQueryID()||this._lastQueryID),!t)throw new Error("No queryID was retrieved, please check the implementation and provide either a getQueryID function\n    or calls the search method that will return the queryID");this.storageManager.storeClick(e.objectID,t);var n=Object.assign({},e,{queryID:t});this.sendEvent("click",n)}.bind(this),this.conversion=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("No parameters were sent to conversion event, please provide an objectID");if(!e.objectID)throw new Error("No objectID was sent to conversion event, please provide an objectID");var t=this.storageManager.getConversionObjectID(e.objectID),n=Object.assign(e,{queryID:t.queryID});if(!t)return!1;this.sendEvent("conversion",n)}.bind(this),this.search=function(e){if(!e)throw new Error("Search functions has to be called with a query string, which cannot be undefined");if(!e.index)throw new Error("Please provide index of the index being searched");this.sendEvent("search",e)}.bind(this),this._userID=i(),this.processQueue()}});
