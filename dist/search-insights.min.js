
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AlgoliaAnalytics=t()}(this,function(){"use strict";const e="insights-store";class t{constructor(){if(this.storeClick=((e,t)=>{let n=JSON.parse(localStorage.getItem("insights-store"))||{};n[e]={queryID:t,eventTimestamp:(new Date).getTime()},localStorage.setItem(this._storageKey,JSON.stringify(n))}),this.getConversionObjectID=(e=>{const t=this.getStorageData()[e];return t||!1}),this.cleanOldStorage=((e,t)=>{const n=Object.keys(t);if(n.length>0){return n.reduce((n,r)=>{const o=t[r];return Math.abs(e-o.eventTimestamp)/36e5<=6&&(n[r]=o),n},{})}return{}}),this.getStorageData=(()=>JSON.parse(localStorage.getItem("insights-store"))||{}),!function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}("localStorage"))throw new Error("LocalStorage is not available");this._storageKey=e;const t=(new Date).getTime(),n=this.getStorageData(),r=this.cleanOldStorage(t,n);localStorage.setItem(this._storageKey,JSON.stringify(r))}}const n=(e,t,n)=>{var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var o="expires="+r.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"},r=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),o=e=>{const t=(e=>{for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""})("_ALGOLIA");if(t&&""!==t)return n("_ALGOLIA",t,10),t;{const e=r();return n("_ALGOLIA",e,10),e}};var i,s,a,c;Object.keys||(Object.keys=(i=Object.prototype.hasOwnProperty,s=!{toString:null}.propertyIsEnumerable("toString"),c=(a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("function"!=typeof e&&("object"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var t,n,r=[];for(t in e)i.call(e,t)&&r.push(t);if(s)for(n=0;n<c;n++)i.call(e,a[n])&&r.push(a[n]);return r})),"function"!=typeof Object.assign&&(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const n=Object(e);for(let e=1;e<arguments.length;e++){const t=arguments[e];if(null!=t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n});return new class{constructor(e){if(this._hasCredentials=!1,!document.addEventListener||!window)throw new Error("Browser does not support eventlistener or there is no window object.");this.storageManager=new t,this.processQueue=function(){let e=window.AlgoliaAnalyticsObject;e&&((window[e].queue||[]).forEach(e=>{const t=e[0],n=e[1];t&&"function"==typeof this[t]&&this[t](n)}),window[e]=((e,t)=>{this[e](t)}))}.bind(this),this.sendEvent=function(e,t){t.timestamp=Date.now(),t.userID=this._userID;const n=`http://localhost:8080/1/${e}`+`?X-Algolia-Application-Id=${this._applicationID}&X-Algolia-API-Key=${this._apiKey}`;if(navigator&&"function"==typeof navigator.sendBeacon&&"search"!==e)navigator.sendBeacon(n,JSON.stringify(t));else{const r=new XMLHttpRequest;r.open("POST",n),"search"===e&&(r.onreadystatechange=(()=>{if(4===r.readyState&&r.responseText){const e=r&&r.responseText?JSON.parse(r.responseText):{};this._lastQueryID=e.queryID}})),r.send(JSON.stringify(t))}}.bind(this),this.init=function(e){if(!e)throw new Error("Init function should be called with an object argument containing your apiKey and applicationID");if(!e.apiKey||"string"!=typeof e.apiKey)throw new Error("apiKey is missing, please provide it so we can authenticate the application");if(!e.applicationID||"string"!=typeof e.applicationID)throw new Error("applicationID is missing, please provide it, so we can properly attribute data to your application");this._apiKey=e.apiKey,this._applicationID=e.applicationID,this._hasCredentials=!0}.bind(this),this.initSearch=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("initSearch function requires an argument with getQueryID and hitsContainer arguments");if(!e.getQueryID||"function"!=typeof e.getQueryID)throw new Error("getQueryID must be a function that returns the queryID of the last search operation");this.getQueryID=e.getQueryID}.bind(this),this.click=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("No params were sent to click function, please provide an objectID and position to be reported");if(!e.objectID)throw new Error("required objectID parameter was not sent, click event can not be properly attributed");if(!e.position)throw new Error("required position parameter was not sent, click event position can not be properly sent without");let t=e.queryID;if("function"!=typeof this.getQueryID||t||(t=this.getQueryID()||this._lastQueryID),!t)throw new Error("No queryID was retrieved, please check the implementation and provide either a getQueryID function\n    or calls the search method that will return the queryID");this.storageManager.storeClick(e.objectID,t);const n=Object.assign({},e,{queryID:t});this.sendEvent("click",n)}.bind(this),this.conversion=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("No parameters were sent to conversion event, please provide an objectID");if(!e.objectID)throw new Error("No objectID was sent to conversion event, please provide an objectID");const t=this.storageManager.getConversionObjectID(e.objectID),n=Object.assign(e,{queryID:t.queryID});if(!t)return!1;this.sendEvent("conversion",n)}.bind(this),this.search=function(e){if(!e)throw new Error("Search functions has to be called with a query string, which cannot be undefined");if(!e.index)throw new Error("Please provide index of the index being searched");this.sendEvent("search",e)}.bind(this),this._userID=o(),this.processQueue()}}});